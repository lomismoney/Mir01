# 📘 庫存管理系統 - 本地開發指南

## 🏗️ 系統需求

### 必要軟體
- **Laragon** (推薦) 或 XAMPP/WAMP
  - PHP >= 8.2
  - MySQL >= 8.0
  - Apache/Nginx
- **Node.js** >= 18.x
- **Composer** >= 2.0
- **Git**

### 推薦工具
- **phpMyAdmin** (通常包含在 Laragon 中)
- **VS Code** 或其他程式編輯器
- **Postman** (API 測試)

---

## 🚀 快速開始

### 1. 克隆專案
```bash
git clone <repository-url>
cd Mir01
```

### 2. 後端設置 (Laravel API)

#### 2.1 安裝依賴
```bash
cd inventory-api
composer install
```

#### 2.2 環境配置
```bash
# 複製環境文件
cp .env.example .env

# 生成應用密鑰
php artisan key:generate
```

#### 2.3 配置資料庫
編輯 `.env` 文件，確保資料庫設定正確：

```env
# Laragon 本地開發環境設定
APP_NAME=Laravel
APP_ENV=local
APP_DEBUG=true
APP_URL=http://localhost:8000

# Laragon MySQL 數據庫配置
DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=inventory-api
DB_USERNAME=root
DB_PASSWORD=

# Sanctum 設定 - 允許前端網域進行有狀態認證
SANCTUM_STATEFUL_DOMAINS=localhost:3000,127.0.0.1:3000,localhost:8000,127.0.0.1:8000

# Session 設定 - 允許跨網域 cookie
SESSION_DOMAIN=localhost
```

#### 2.4 創建資料庫
在 Laragon 的 phpMyAdmin 中創建名為 `inventory-api` 的資料庫，或使用 MySQL 命令：

```sql
CREATE DATABASE `inventory-api` CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

#### 2.5 執行遷移
```bash
# 檢查資料庫連接
php artisan db:show

# 執行遷移和種子資料
php artisan migrate:fresh --seed
```

#### 2.6 啟動後端服務
```bash
# 啟動 Laravel 開發服務器
php artisan serve
```

Laravel 應用將在 `http://localhost:8000` 運行。

### 3. 前端設置 (Next.js)

#### 3.1 安裝依賴
```bash
cd ../inventory-client
npm install
```

#### 3.2 環境配置
```bash
# 複製環境文件
cp .env.example .env.local
```

確保 `.env.local` 文件包含正確的 API 端點：

```env
# API 配置 - 指向 Laragon 本地開發服務
NEXT_PUBLIC_API_BASE_URL=http://localhost:8000

# 開發環境標識
NEXT_PUBLIC_ENV=development

# Auth.js 配置 - 用於加密 session cookie 的密鑰
AUTH_SECRET="your-secret-key-here"

# NextAuth URL 配置 - 確保重定向在所有環境中正常工作
NEXTAUTH_URL=http://localhost:3000
```

#### 3.3 啟動前端服務
```bash
# 啟動 Next.js 開發服務器
npm run dev
```

前端應用將在 `http://localhost:3000` 運行。

---

## 🗄️ 資料庫設定

### Laragon MySQL 配置
Laragon 預設配置：
- **主機**: 127.0.0.1
- **端口**: 3306
- **用戶名**: root
- **密碼**: (空白)
- **資料庫**: inventory-api

### 驗證資料庫連接
```bash
cd inventory-api
php artisan db:show
```

如果連接成功，您將看到資料庫資訊。

---

## 🧪 測試系統

### 1. 後端 API 測試
```bash
cd inventory-api

# 執行所有測試
php artisan test

# 執行特定測試
php artisan test --filter=ProductTest
```

### 2. 前端測試
```bash
cd inventory-client

# 執行 linting
npm run lint

# 構建測試
npm run build
```

### 3. 手動測試
1. 訪問 `http://localhost:3000` 查看前端
2. 訪問 `http://localhost:8000/api/documentation` 查看 API 文檔
3. 測試登入功能
4. 測試產品管理功能

---

## 📊 開發工具

### API 文檔生成
```bash
cd inventory-api

# 清除路由快取
php artisan route:clear
php artisan optimize:clear

# 生成 API 文檔
php artisan scribe:generate
```

API 文檔將在 `http://localhost:8000/docs` 可用。

### 效能分析
```bash
cd inventory-client

# 執行效能測試
npm run perf:test

# 分析打包大小
npm run perf:analyze
```

---

## 🔧 常見問題

### 1. 資料庫連接失敗
**問題**: 無法連接到 MySQL 資料庫

**解決方案**:
- 確保 Laragon 的 MySQL 服務正在運行
- 檢查 `.env` 文件中的資料庫配置
- 確認資料庫 `inventory-api` 已創建

```bash
# 測試資料庫連接
php artisan db:show
```

### 2. 前端 API 請求失敗
**問題**: 前端無法連接到後端 API

**解決方案**:
- 確保後端服務在 `http://localhost:8000` 運行
- 檢查 `.env.local` 中的 `NEXT_PUBLIC_API_BASE_URL` 設定
- 確認 CORS 設定正確

### 3. 認證問題
**問題**: 登入後立即被登出

**解決方案**:
- 檢查 `SESSION_DOMAIN` 設定
- 確認 `SANCTUM_STATEFUL_DOMAINS` 包含前端域名
- 清除瀏覽器 cookie 和快取

### 4. 前端依賴問題
**問題**: `npm run dev` 失敗，提示 'next' 不是內部命令

**解決方案**:
```bash
cd inventory-client
rm -rf node_modules package-lock.json
npm install
npm run dev
```

---

## 📈 效能優化

### 1. 後端優化
```bash
cd inventory-api

# 清除並重新生成快取
php artisan config:cache
php artisan route:cache
php artisan view:cache
```

### 2. 前端優化
```bash
cd inventory-client

# 分析打包大小
npm run build -- --analyze

# 使用生產模式
npm run build
npm run start
```

---

## 🔒 安全性檢查

### 1. 環境文件安全
- 確保 `.env` 文件不會被提交到版本控制
- 使用強密碼和隨機金鑰
- 定期更新依賴包

### 2. API 安全
- 所有 API 端點都需要適當的驗證
- 使用 HTTPS (生產環境)
- 實施請求速率限制

---

## 📝 開發流程

### 1. 新功能開發
1. 創建新分支
2. 實施後端 API
3. 更新前端介面
4. 撰寫測試
5. 更新文檔
6. 提交 Pull Request

### 2. 程式碼品質
- 使用 Laravel Pint 格式化 PHP 程式碼
- 使用 ESLint 和 Prettier 格式化 JavaScript/TypeScript
- 撰寫單元測試和整合測試

---

## 🚀 生產部署

### 準備清單
- [ ] 設定生產環境變數
- [ ] 配置 HTTPS
- [ ] 設定資料庫備份
- [ ] 配置日誌監控
- [ ] 效能測試
- [ ] 安全性檢查

---

## 📞 支援與幫助

如果遇到問題，請：
1. 檢查此文檔的常見問題部分
2. 查看專案的 GitHub Issues
3. 聯繫開發團隊

---

*最後更新: 2024年12月* 